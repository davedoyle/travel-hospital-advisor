<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Travel to Hospital Advisor</title>
  <script>
      // --- Fetch live weather from backend Weather API ---
          async function loadWeather(hospitalCode) {
            try {
              // Call your local backend API (adjust port if needed)
              const response = await fetch(`http://localhost:5028/api/weather/${hospitalCode}`);
                  if (!response.ok) throw new Error("Weather API not responding");

                  const data = await response.json();

              // Debug log
                  console.log("Weather data:", data);

              // Update DOM
                  document.getElementById("weather-temp").textContent = `${data.temperature.toFixed(1)}°C`;
                  document.getElementById("weather-cond").textContent = data.condition;
                  document.getElementById("weather-uv").textContent = `UV Index: ${data.uv.toFixed(1)}`;
                  document.getElementById("last-updated").textContent = `Last updated: ${new Date(data.timestamp).toLocaleString()}`;
                } 
            catch (err) {
                  console.error("Error fetching weather:", err);
                  document.getElementById("weather-temp").textContent = "--°C";
                  document.getElementById("weather-cond").textContent = "Error fetching data";
                }
          }
         
         // window.onload = () => loadWeather("CUH");

      // --- Fetch live bus data from backend TFI API ---
        async function loadBusTimes(hospitalCode) {
          try {
            const response = await fetch(`http://localhost:5030/api/bus/${hospitalCode}`);
            if (!response.ok) throw new Error("Bus API not responding");

            const data = await response.json();
            console.log("Bus data:", data);

            // Clear previous results
            const busList = document.getElementById("bus-times");
            busList.innerHTML = "";

            // Loop through buses and add each one
            data.buses.forEach(bus => {
              const li = document.createElement("li");
              li.textContent = `Route ${bus.route} → ${bus.destination} (${bus.due_in})`;
              busList.appendChild(li);
            });

            document.getElementById("bus-last-updated").textContent = 
              `Last updated: ${new Date(data.timestamp).toLocaleTimeString()}`;
          } 
          catch (err) {
            console.error("Error fetching bus times:", err);
            document.getElementById("bus-times").innerHTML = "<li>Error fetching data</li>";
          }
        }
           // Run automatically on load (default CUH)
        window.onload = () => {
                                loadWeather("CUH");
                                loadBusTimes("CUH");
                              };


</script>
  </script>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    /* --- Custom colour palette from coolors.co https://coolors.co/0dab76-139a43-0b5d1e-053b06-000000 --- */
    :root {
      --jade: #0DAB76;
      --pigment: #139A43;
      --dartmouth: #0B5D1E;
      --pakistan: #053B06;
      --black: #000000;
    }

    body {
      background-color: #f4f7f4;
      color: var(--black);
      font-family: 'Segoe UI', sans-serif;
    }

    .header {
      background-color: var(--dartmouth);
      color: white;
      padding: 12px 20px;
      border-radius: 10px;
    }

    .btn-primary {
      background-color: var(--pigment);
      border: none;
    }
    .btn-primary:hover {
      background-color: var(--jade);
    }

    .section-box {
      background-color: white;
      border-left: 6px solid var(--pigment);
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    .suggestion {
      background-color: var(--jade);
      color: white;
      border-radius: 10px;
      padding: 15px;
      font-weight: 500;
    }

    footer {
      font-size: 0.9rem;
      color: #333;
      margin-top: 15px;
    }
  </style>
</head>

<body class="container py-4">

  <!-- Header -->
  <div class="row mb-3">
    <div class="col-md-6">
      <h3 class="header">Travel to Hospital Advisor</h3>
    </div>
    <div class="col-md-6 text-end">
      <button class="btn btn-primary">Select Hospital Site</button>
    </div>
  </div>

  <!-- Hospital Choice -->
  <div class="row text-center mb-4">
    <div class="col">
      <div class="section-box">
        <strong>Hospital Choice:</strong> [CUH / SFH]
      </div>
    </div>
  </div>

  <!-- Three Panels -->
  <div class="row g-4 text-center mb-4">
   <div class="col-md-4">
    <div class="section-box">
      <h5>Next Buses at CUH</h5>
        <ul id="bus-times" style="list-style:none; padding-left:0;">
        <li>Loading...</li>
        </ul>
        <small id="bus-last-updated" style="color:gray;">Last updated: --</small>
    </div>
</div>
    <div class="col-md-4">
  <div class="section-box">
      <h5>Weather for Location</h5>
    <p>
      Temperature: <span id="weather-temp">--°C</span><br>
      Condition: <span id="weather-cond">--</span><br>
      <span id="weather-uv">UV Index: --</span>
    </p>
       </div>
    </div>
    <div class="col-md-4">
      <div class="section-box">
        <h5>Car Park Status</h5>
        <p>Car Park 1 CUH: 45/50<br>Car Park 2 CUH: 32/60<br>Car Park 3 CUH: 20/90</p>
      </div>
    </div>
  </div>

  <!-- Suggestion Box -->
  <div class="row">
    <div class="col">
      <div class="suggestion text-center">
        Heavy Rain forecast today, CAR PARKS WILL BE BUSY, COLD Bring Coat, BUS will be busy, allow time.
        Car Parks at selected hospital at XX% capacity.
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="d-flex justify-content-between mt-3">
    <div>Powered by TFI / Open Meteo</div>
    <div id="last-updated">Last updated: --</div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
